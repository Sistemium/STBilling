<?xml version="1.0" encoding="UTF-8"?>

<domain version="1.0"
    xmlns="http://unact.net/xml/xi"
    server="STCentral"
>

    <concept name="stb-org">
        
        <select owner="stb" sql-name="Org" />
        
        <property name="xid"/>
        <property name="id" key="true" type="int"/>
        
        <property name="name" label="Название"/>
        
    </concept>
    
    <concept name="stb-contract">
        
        <property name="xid"/>
        <property name="id" key="true" type="int"/>
        
        <property name="ndoc" label="Номер"/>
        <property name="dateB" type="date" label="Дата начала"/>
        <property name="dateE" type="date" label="Дата окончания"/>
        
        <property name="name" label="Название" sql-compute="string(ndoc, ' от ', [date]"/>
        
        <role name="org" actor="stb-org"/>
        
    </concept>
    
    <concept name="stb-contract-tariff">
        
        <select owner="stb" sql-name="period" type="procedure">
            <parameter name="stb-period" sql-name="@period" type="int"/>
        </select>
        
        <property name="xid"/>
        <property name="id" key="true" type="int"/>
        
        <property name="price" label="Цена"/>
        
        <role name="contract" actor="stb-contract"/>
        <role name="service" actor="stb-service"/>
        <role name="stb-period" actor="stb-period"/>
        
    </concept>
    
    <concept name="stb-service">
        
        <property name="xid"/>
        <property name="id" key="true" type="int"/>
        
        <property name="name" label="Название"/>
        
    </concept>
    
    <concept name="stb-period">
        
        <select type="procedure" owner="stb" sql-name="periodByOrg">
            <parameter name="org" type="int" sql-name="@org" required="true"/>
        </select>
        
        <property name="dateB" type="date" label="Дата начала"/>
        <property name="dateE" type="date" label="Дата окончания"/>
        
        <property name="name" label="Период"/>
        
        <role name="org" actor="stb-org"/>
        
    </concept>
    
    <concept name="stb-invoice">
        
        <property name="xid"/>
        <property name="id" key="true" type="int"/>
        
        <property name="date" type="date" label="Дата"/>
        <property name="ndoc" label="Номер"/>
        <property name="name" label="Название" sql-compute="string(ndoc, ' от ', [date]"/>
        
        <role name="contract" actor="stb-contract"/>
        
    </concept>
    
    <concept name="stb-invoice-item">
        
        <property name="xid"/>
        <property name="id" key="true" type="int"/>
        
        <property name="volume" type="int" label="Кол-во"/>
        <property name="price" type="decimal" label="Цена"/>
        <property name="cost" type="decimal" label="Стоимость"/>
        
        <role name="invoice" actor="stb-invoice"/>
        <role name="service" actor="stb-service"/>
        
    </concept>
    
    <concept name="stb-db">
        
        <property name="xid"/>
        <property name="id" key="true" type="int"/>
        
        <property name="name" label="Название"/>
        <property name="hrefGet" label="GET arest address"/>
        <property name="timezone" label="Timezone code"/>
        
        <role name="org" actor="stb-org"/>
        
    </concept>
    
    <concept name="stb-accrual" label="Начисление">
        
        <select owner="stb" sql-name="accuralByPeriod" type="procedure">
            <parameter name="stb-period" sql-name="@period" type="int" required="true"/>
        </select>
        
        <property name="xid"/>
        <property name="id" key="true" type="int"/>
        
        <property name="issue-href" label="Техзадание"/>
        <property name="volume" type="int" label="Кол-во"/>
        <property name="description" label="Описание"/>
        
        <property name="acceptance-date" type="date" label="Дата приемки"/>
        
        <role name="org" actor="stb-org"/>
        <role name="service" actor="stb-service"/>
        
        <role name="stb-period" actor="stb-period"/>
        
    </concept>
    
    <concept name="stb-usage">
        
        <property name="xid"/>
        <property name="id" key="true" type="int"/>
        
        <property name="date" type="date" label="Дата"/>
        <property name="hour" type="int" label="Час"/>
        <property name="username" label="Пользователь"/>
        <property name="program" label="Программа"/>
        <property name="path" label="Инстанс"/>
        <property name="cnt" type="int" label="Кол-во запросов"/>
        
        <role name="db" actor="stb-db"/>
        <role name="service" actor="stb-service"/>
        
    </concept>
    
</domain>